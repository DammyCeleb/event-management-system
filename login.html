<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventHub - Authentication</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="auth.css">
    <script src="config.js"></script>
</head>
<body>
    <div class="auth-container">
        <!-- Left Column -->
        <div class="left-column">
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon" id="theme-icon"></i>
            </button>
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <h1 class="app-name">EventHub</h1>
                <p class="tagline">Where memorable experiences begin</p>
                <div class="value-proposition">
                    <h3>Elevate your event experience</h3>
                    <p>Join a community of event enthusiasts, organizers, and attendees who believe in creating meaningful connections through exceptional events.</p>
                </div>
                <ul class="features">
                    <li><i class="fas fa-sparkles"></i> <span>Curate extraordinary events</span></li>
                    <li><i class="fas fa-users"></i> <span>Build lasting connections</span></li>
                    <li><i class="fas fa-chart-line"></i> <span>Insights that matter</span></li>
                    <li><i class="fas fa-shield-check"></i> <span>Trust & security first</span></li>
                </ul>
                <div class="illustration">
                    <i class="fas fa-glass-cheers"></i>
                    <i class="fas fa-gift"></i>
                    <i class="fas fa-star"></i>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="right-column">
            <div class="form-card">
                <div class="form-header">
                    <h2 id="formTitle">Welcome Back</h2>
                    <p id="formSubtitle">Continue your journey with us</p>
                </div>

                <form id="authForm" novalidate>
                    <!-- Register Fields -->
                    <div id="registerFields" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName">First Name <span class="required">*</span></label>
                                <input type="text" id="firstName" placeholder="John">
                                <div class="field-error" id="firstNameError"></div>
                            </div>
                            <div class="form-group">
                                <label for="lastName">Last Name <span class="required">*</span></label>
                                <input type="text" id="lastName" placeholder="Doe">
                                <div class="field-error" id="lastNameError"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" placeholder="+1 (555) 123-4567">
                            <div class="field-error" id="phoneError"></div>
                        </div>

                        <div class="form-group">
                            <label for="organization">Organization/Company</label>
                            <input type="text" id="organization" placeholder="Your company name">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email Address <span class="required">*</span></label>
                        <input type="email" id="email" required placeholder="john@example.com">
                        <div class="field-error" id="emailError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password <span class="required">*</span></label>
                        <input type="password" id="password" required placeholder="Enter your password">
                        <div class="field-error" id="passwordError"></div>
                        <div class="password-strength" id="passwordStrength" style="display: none;">
                            <div class="strength-bar">
                                <div class="strength-fill" id="strengthFill"></div>
                            </div>
                            <span id="strengthText"></span>
                        </div>
                    </div>

                    <div id="confirmPasswordGroup" class="form-group" style="display: none;">
                        <label for="confirmPassword">Confirm Password <span class="required">*</span></label>
                        <input type="password" id="confirmPassword" placeholder="Confirm your password">
                        <div class="field-error" id="confirmPasswordError"></div>
                    </div>
                    
                    <div class="form-group" id="roleGroup" style="display: none;">
                        <label for="role">How will you use EventHub? <span class="required">*</span></label>
                        <div class="role-selection">
                            <div class="role-option" data-role="attendee">
                                <div class="role-icon"><i class="fas fa-user-friends"></i></div>
                                <div class="role-content">
                                    <h4>Event Enthusiast</h4>
                                    <p>Discover and attend amazing events</p>
                                </div>
                            </div>
                            <div class="role-option" data-role="organizer">
                                <div class="role-icon"><i class="fas fa-calendar-plus"></i></div>
                                <div class="role-content">
                                    <h4>Event Creator</h4>
                                    <p>Organize and manage memorable events</p>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="role">
                        <div class="field-error" id="roleError"></div>
                    </div>

                    <div id="bioGroup" class="form-group" style="display: none;">
                        <label for="bio">Tell us about yourself <span class="optional">(Optional)</span></label>
                        <textarea id="bio" rows="3" placeholder="Share what makes you passionate about events..."></textarea>
                    </div>

                    <div id="termsGroup" class="checkbox-group" style="display: none;">
                        <div class="custom-checkbox">
                            <input type="checkbox" id="terms">
                            <label for="terms" class="checkbox-label">
                                <span class="checkmark"></span>
                                <span class="checkbox-text">I agree to EventHub's <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a> <span class="required">*</span></span>
                            </label>
                        </div>
                        <div class="field-error" id="termsError"></div>
                    </div>
                    
                    <button type="submit" class="btn" id="submitBtn">Sign In</button>
                    <div id="message"></div>
                </form>

                <div class="form-footer">
                    <p class="toggle-text">
                        <span id="toggleQuestion">New to EventHub?</span>
                        <a href="#" id="toggleMode">Create your account</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Theme toggle
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.dataset.theme = savedTheme;
        themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.body.dataset.theme;
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.dataset.theme = newTheme;
            localStorage.setItem('theme', newTheme);
            themeIcon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        });

        // Form elements
        let isLogin = true;
        const form = document.getElementById('authForm');
        const registerFields = document.getElementById('registerFields');
        const roleGroup = document.getElementById('roleGroup');
        const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');
        const bioGroup = document.getElementById('bioGroup');
        const termsGroup = document.getElementById('termsGroup');
        const submitBtn = document.getElementById('submitBtn');
        const toggleMode = document.getElementById('toggleMode');
        const messageDiv = document.getElementById('message');
        const formTitle = document.getElementById('formTitle');
        const formSubtitle = document.getElementById('formSubtitle');
        const toggleQuestion = document.getElementById('toggleQuestion');
        const passwordInput = document.getElementById('password');
        const passwordStrength = document.getElementById('passwordStrength');
        
        // Role selection handling
        document.addEventListener('click', (e) => {
            if (e.target.closest('.role-option')) {
                const roleOption = e.target.closest('.role-option');
                const role = roleOption.dataset.role;
                
                // Remove active class from all options
                document.querySelectorAll('.role-option').forEach(opt => opt.classList.remove('active'));
                
                // Add active class to selected option
                roleOption.classList.add('active');
                
                // Set hidden input value
                document.getElementById('role').value = role;
            }
        });

        // Password strength checker
        passwordInput.addEventListener('input', (e) => {
            if (!isLogin) {
                checkPasswordStrength(e.target.value);
            }
        });

        function checkPasswordStrength(password) {
            const strengthFill = document.getElementById('strengthFill');
            const strengthText = document.getElementById('strengthText');
            
            if (password.length === 0) {
                passwordStrength.style.display = 'none';
                return;
            }
            
            passwordStrength.style.display = 'block';
            
            let score = 0;
            if (password.length >= 8) score++;
            if (/[a-z]/.test(password)) score++;
            if (/[A-Z]/.test(password)) score++;
            if (/[0-9]/.test(password)) score++;
            if (/[^A-Za-z0-9]/.test(password)) score++;
            
            strengthFill.className = 'strength-fill';
            
            if (score <= 2) {
                strengthFill.classList.add('strength-weak');
                strengthText.textContent = 'Weak password';
            } else if (score === 3) {
                strengthFill.classList.add('strength-fair');
                strengthText.textContent = 'Fair password';
            } else if (score === 4) {
                strengthFill.classList.add('strength-good');
                strengthText.textContent = 'Good password';
            } else {
                strengthFill.classList.add('strength-strong');
                strengthText.textContent = 'Strong password';
            }
        }

        // Toggle between login and register
        toggleMode.addEventListener('click', (e) => {
            e.preventDefault();
            isLogin = !isLogin;
            clearErrors();
            
            if (isLogin) {
                registerFields.style.display = 'none';
                roleGroup.style.display = 'none';
                confirmPasswordGroup.style.display = 'none';
                bioGroup.style.display = 'none';
                termsGroup.style.display = 'none';
                passwordStrength.style.display = 'none';
                submitBtn.textContent = 'Sign In';
                toggleMode.textContent = 'Create your account';
                toggleQuestion.textContent = 'New to EventHub?';
                formTitle.textContent = 'Welcome Back';
                formSubtitle.textContent = 'Continue your journey with us';
            } else {
                registerFields.style.display = 'block';
                roleGroup.style.display = 'block';
                confirmPasswordGroup.style.display = 'block';
                bioGroup.style.display = 'block';
                termsGroup.style.display = 'block';
                submitBtn.textContent = 'Create Account';
                toggleMode.textContent = 'Sign in instead';
                toggleQuestion.textContent = 'Already have an account?';
                formTitle.textContent = 'Join EventHub';
                formSubtitle.textContent = 'Begin your event journey today';
            }
            messageDiv.innerHTML = '';
        });

        // Form validation
        function validateForm() {
            clearErrors();
            let isValid = true;

            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            // Email validation
            if (!email) {
                showError('email', 'Email is required');
                isValid = false;
            } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showError('email', 'Please enter a valid email address');
                isValid = false;
            }

            // Password validation
            if (!password) {
                showError('password', 'Password is required');
                isValid = false;
            } else if (!isLogin && password.length < 6) {
                showError('password', 'Password must be at least 6 characters');
                isValid = false;
            }

            if (!isLogin) {
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();
                const confirmPassword = document.getElementById('confirmPassword').value;
                const role = document.getElementById('role').value;
                const terms = document.getElementById('terms').checked;

                // Name validation
                if (!firstName) {
                    showError('firstName', 'First name is required');
                    isValid = false;
                }
                if (!lastName) {
                    showError('lastName', 'Last name is required');
                    isValid = false;
                }

                // Confirm password
                if (password !== confirmPassword) {
                    showError('confirmPassword', 'Passwords do not match');
                    isValid = false;
                }

                // Role validation
                if (!role) {
                    showError('role', 'Please select your account type');
                    isValid = false;
                }

                // Terms validation
                if (!terms) {
                    showError('terms', 'You must agree to the terms and conditions');
                    isValid = false;
                }
            }

            return isValid;
        }

        function showError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorDiv = document.getElementById(fieldId + 'Error');
            
            field.classList.add('error');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            }
        }

        function clearErrors() {
            const errorFields = document.querySelectorAll('.error');
            const errorDivs = document.querySelectorAll('.field-error');
            
            errorFields.forEach(field => field.classList.remove('error'));
            errorDivs.forEach(div => {
                div.style.display = 'none';
                div.textContent = '';
            });
        }

        // Form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!validateForm()) return;
            
            messageDiv.innerHTML = '';
            submitBtn.disabled = true;
            submitBtn.classList.add('btn-loading');

            const formData = {
                email: document.getElementById('email').value.trim(),
                password: document.getElementById('password').value
            };

            if (!isLogin) {
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();
                formData.userId = formData.email; // Use email as userId
                formData.name = `${firstName} ${lastName}`;
                formData.role = document.getElementById('role').value;
                formData.phone = document.getElementById('phone').value.trim();
                formData.organization = document.getElementById('organization').value.trim();
                formData.bio = document.getElementById('bio').value.trim();
            }

            const endpoint = isLogin ? '/api/login' : '/api/register';

            try {
                const response = await fetch(`${window.CONFIG.API_BASE_URL}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (response.ok) {
                    localStorage.setItem('user', JSON.stringify(data.user));
                    messageDiv.innerHTML = `<div class="success">${data.message}</div>`;
                    
                    setTimeout(() => {
                        if (data.user.role === 'admin') {
                            window.location.href = 'admin.html';
                        } else if (data.user.role === 'organizer') {
                            window.location.href = 'organizer.html';
                        } else {
                            window.location.href = 'attendee.html';
                        }
                    }, 1500);
                } else {
                    messageDiv.innerHTML = `<div class="error">${data.error}</div>`;
                }
            } catch (error) {
                messageDiv.innerHTML = '<div class="error">Network error. Please try again.</div>';
            } finally {
                submitBtn.disabled = false;
                submitBtn.classList.remove('btn-loading');
            }
        });
    </script>
</body>
</html>